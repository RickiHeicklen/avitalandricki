<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Avital & Ricki</title>
    <script src="https://platform.twitter.com/widgets.js"></script>
    <link rel="stylesheet" type="text/css" href="./style.css" />
    <!-- Dynamically replace this. -->
    <link rel="shortcut icon" href="./img/favicon2.ico" />
    <meta property="og:title" content="Avital & Ricki" />
    <meta property="og:description" content="Wedding website of Avital Morris and Ricki Heicklen" />

  
    <script src="https://use.fontawesome.com/efc83ea599.js"></script>
    <script>
      fetch('bottom-bar.html')
        .then(response => response.text())
        .then(data => {
          document.getElementById('include-bottom-bar').innerHTML = data;
        });
    </script>
  
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7LL5HKKBDL"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
  
      gtag('config', 'G-7LL5HKKBDL');
    </script>
    <script src="loadHeader.js"></script>
  </head>
<body>

    <div class="header-nav-section" id="header-nav"></div> 

    <footer>
        <div id="include-bottom-bar"></div>
    </footer>
    
    <h1>Shabbaton Booking and Payment</h1>

    <section class="shabbat-information">
        <p>We hope you can join us for our wedding shabbaton!</p>
        <p>Please plan to spend all of Shabbat with us. Arrival and check-in at camp are between 4:30 and 6:00pm on Friday (September 20). The camp gates will re-open after havdalah on Saturday evening at about 7:45pm.</p>
        
        <p>There will be plenty of prayer, learning, vegan feasting in the camp dining room, singing, nature-walking, and lounging, and if weather permits, a post-havdalah campfire by the lake.</p>
        
        <p>On Sunday morning there will be shaharit and breakfast.  Wedding festivities start with a reception and tisch at 3pm, and the huppah is at 4pm.</p> 
        
        <p>We have reserved a block of cabins and bunks at Camp Kinder Ring for Friday and Saturday nights. The total cost for the Shabbat (including food) is $360 per person. We would love to have you for any amount that you wish to contribute to that between $36 and $360.</p>
    </section>

        <!-- https://docs.google.com/forms/d/e/1FAIpQLSd78nSn4ni4X05CxruUc8LmyNe6rrnHaQO2cTD4xZpLj5JwVQ/viewform?usp=pp_url&
    entry.469551914=Name&
    entry.1883004535=Email&
    entry.1405525784=420&
    entry.959352133=AdultNames&
    entry.565550636=27&
    entry.711606456=KidNames&
    entry.110343444=__other_option__&
    entry.110343444.other_option_response=SleepingPreferencesRadio&
    entry.2038316463=SleepingPreferencesText&
    entry.41062795=DietaryNeeds&
    entry.284877517=Accommodations&
    entry.353919477=FridayBus&
    entry.932032766=PaymentAmount&
    entry.407849913=OtherQuestions -->

    <form id="bookingForm">
        <label for="name">Name:</label>
        <input type="text" id="name" name="entry.469551914" required>
        
        <label for="email">Email:</label>
        <input type="email" id="email" name="entry.1883004535" required>

        <label for="canAttend">Will you be able to join us for Shabbat?</label>
        <select id="canAttend" name="canAttend" required>
            <option value="">Select an option</option>
            <option value="yes">Yes!</option>
            <option value="no">Regretfully, no</option>
        </select>

        <div id="formDetails" class="hidden">

            <label for="adultNumber">Number of Adults:</label>
            <input type="number" id="adultNumber" name="entry.1405525784" min="0" placeholder="0" required>

            <label for="adultNames">Names of All Adult Attendees:</label>
            <textarea id="adultNames" name="entry.959352133" placeholder="Please enter the full names of all adult attendees, including yourself, one per line." required></textarea>

            <label for="kidNumber">Number of Children:</label>
            <input type="number" id="kidNumber" name="entry.565550636" min="0" placeholder="0" required>

            <label for="kidNames">Names of All Children Attendees:</label>
            <textarea id="kidNames" name="entry.711606456" placeholder="Please enter the full names of all children, one per line." required></textarea>


            <!-- <label for="SleepingPreferencesRadio">Sleeping Preferences:</label>
            <input type="radio" id="SleepingPreferencesRadio" name="entry.110343444" value="Cabin" required>
            <label for="Cabin">Cabin</label>
            <input type="radio" id="SleepingPreferencesRadio" name="entry.110343444" value="Bunk" required>
            <label for="Bunk">Bunk</label>
            <input type="radio" id="SleepingPreferencesRadio" name="entry.110343444" value="Other" required> -->

            <label for="SleepingPreferencesText">Sleeping Preferences:</label>
            <input type="text" id="SleepingPreferencesText" name="entry.2038316463" placeholder="Please specify your sleeping preferences." required>

            <label for="DietaryNeeds">Dietary Needs:</label>
            <input type="text" id="DietaryNeeds" name="entry.41062795" placeholder="Please specify any dietary needs or restrictions." required>

            <label for="Accommodations">Accommodations:</label>
            <input type="text" id="Accommodations" name="entry.284877517" placeholder="Please specify any accommodations you require." required>

            <label for="FridayBus">We may have a bus to the venue on Friday, depending on demand. Alternatively, feel free to coordinate carpools via <a href="https://bit.ly/shabbat-carpool">this spreadsheet.</a></label>
            <input type="text" id="FridayBus" name="entry.353919477" placeholder="If you're interested in taking the Friday bus, put 'Yes' here." required>

            <label for="OtherQuestions">Other Questions:</label>
            <input type="text" id="OtherQuestions" name="entry.407849913" placeholder="Please specify any other questions or concerns you have." required>

            <button type="button" id="proceedToBookRooms">Proceed to Book Rooms</button>
            <button type="button" id="rsvpAndBookLater">RSVP and Book Later</button>

            <div id="paymentSection" class="hidden">
                <label for="amount">Amount to pay per person (recommended $36 - $360):</label>
                <input type="number" id="amount" name="entry.932032766" min="36" required>
                <div id="paypal-button-container"></div>
            </div>
        </div>

        <button type="button" id="rsvpButton" class="hidden">RSVP</button>
        <div id="bookingOptions" class="hidden">
            <label for="amount">Amount to pay per person (recommended $36 - $360):</label>
            <input type="number" id="amount" name="entry.932032766" min="36" required>
            <div id="paypal-button-container"></div>
        </div>

    </form>

    <script>
        const paypalClientId = 'AceKlA6TjthA4vexmgE8c3g0BVl2NrlWHosTWPss2oSOhwhrFneJIxpNuRGaqOQiev87zB6h2d0rsUqM';
        const paypalScript = document.createElement('script');
        paypalScript.src = `https://www.paypal.com/sdk/js?client-id=${paypalClientId}&currency=USD&intent=capture&commit=true`;
        document.head.appendChild(paypalScript);
    </script>

    <script>
        const form = document.getElementById('bookingForm');
        const canAttend = document.getElementById('canAttend');
        const formDetails = document.getElementById('formDetails');
        const rsvpButton = document.getElementById('rsvpButton');
        const bookingOptions = document.getElementById('bookingOptions');
        const adultsSelect = document.getElementById('adultNumber');
        const kidsSelect = document.getElementById('kidNumber');

        canAttend.addEventListener('change', function() {
        if (this.value === 'no') {
                formDetails.classList.add('hidden');
                bookingOptions.classList.add('hidden');
                rsvpButton.classList.remove('hidden');
            } else if (this.value === 'yes') {
                formDetails.classList.remove('hidden');
                checkAttendees();
            } else {
                formDetails.classList.add('hidden');
                bookingOptions.classList.add('hidden');
                rsvpButton.classList.add('hidden');
            }
        });

        function checkAttendees() {
            const adults = parseInt(adultsSelect.value, 10);
            const kids = parseInt(kidsSelect.value, 10);
            if (!isNaN(adults) && !isNaN(kids) && (adults > 0 || kids > 0)) {
                rsvpButton.classList.remove('hidden');
                bookingOptions.classList.remove('hidden');
            } else {
                rsvpButton.classList.add('hidden');
                bookingOptions.classList.add('hidden');
            }
        }

        adultsSelect.addEventListener('change', checkAttendees);
        kidsSelect.addEventListener('change', checkAttendees);

        rsvpButton.addEventListener('click', function() {
            const formData = new FormData(form);
            console.log('Form data:', formData);
            fetch('https://docs.google.com/forms/d/e/1FAIpQLSd78nSn4ni4X05CxruUc8LmyNe6rrnHaQO2cTD4xZpLj5JwVQ/viewform?usp=pp_url', {
                method: 'POST',
                body: formData,
                mode: 'no-cors'
            }).then(() => {
                alert('RSVP completed! Thank you for your response.');
                form.reset(); // Optionally reset the form
            }).catch(error => {
                console.error('Error:', error);
                alert('There was an error with your RSVP. Please contact us directly.');
            });
        });

        function updatePayPalButton() {


            document.getElementById('paypal-button-container').innerHTML = '';
            
            paypal.Buttons({
                fundingSource: paypal.FUNDING.PAYPAL,
                createOrder: function(data, actions) {
                    // const amount = amountInput.value * (adultsSelect.value + kidsSelect.value);
                    const amount = document.getElementById('amount');
                    const amountPerPerson = parseFloat(amount.value);
                    const peopleTotal = parseInt(adultsSelect.value) + parseInt(kidsSelect.value);

                    if (isNaN(amountPerPerson) || isNaN(peopleTotal) || peopleTotal === 0) {
                        alert('Please enter valid numbers for amount per person and number of attendees.');
                        return; // Stop further execution if validation fails
                    }
                    const totalAmount =  (amountPerPerson * peopleTotal).toFixed(2); 

                    console.log('Amount per person: ' + amountPerPerson);
                    console.log('People total: ' + peopleTotal);
                    console.log('Total amount: ' + totalAmount);

                    return actions.order.create({
                        purchase_units: [{
                            amount: {
                                value: totalAmount
                            },
                            description: 'Shabbat Kallot Booking'
                        }]
                    });
                },
                onApprove: function(data, actions) {
                    return actions.order.capture().then(function(details) {
                        // Add transaction ID to form
                        const transactionIdInput = document.createElement('input');
                        transactionIdInput.type = 'hidden';
                        transactionIdInput.name = 'entry.729439330'; // this is for the paypal transaction id
                        transactionIdInput.value = details.id;
                        form.appendChild(transactionIdInput);

                        // Submit to Google Form
                        const formData = new FormData(form);
                        console.log('Form data:', formData);
                        fetch('https://docs.google.com/forms/d/185vI152rd-Af7lwCKVxd2KujoBSclhJXQSQ2Z0vKc_0/formResponse', {
                            method: 'POST',
                            body: formData,
                            mode: 'no-cors'
                        }).then(() => {
                            alert('Booking completed! Your transaction ID is: ' + details.id);
                            form.reset();
                        }).catch(error => {
                            console.error('Error:', error);
                            alert('There was an error submitting your booking. Please contact us directly.');
                        });
                    });
                }
            }).render('#paypal-button-container');
        }

        // https://docs.google.com/forms/d/e/1FAIpQLSd78nSn4ni4X05CxruUc8LmyNe6rrnHaQO2cTD4xZpLj5JwVQ/viewform?usp=pp_url&entry.469551914=YourName&entry.1883004535=Email&entry.1405525784=NumPeople&entry.1275671850=PeopleNames&entry.41062795=DietaryNeeds&entry.284877517=Accomodations&entry.110343444=__other_option__&entry.110343444.other_option_response=SleepingPreferences&entry.932032766=PaymentNumber&entry.407849913=OtherQuestions

        amountInput.addEventListener('input', updatePayPalButton);

    </script>
    

</body>
</html>