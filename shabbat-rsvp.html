<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Avital & Ricki</title>
    <script src="https://platform.twitter.com/widgets.js"></script>
    <link rel="stylesheet" type="text/css" href="./style.css" />
    <link rel="shortcut icon" href="./img/favicon2.ico" />
    <meta property="og:title" content="Avital & Ricki" />
    <meta property="og:description" content="Wedding website of Avital Morris and Ricki Heicklen" />

  
    <script src="https://use.fontawesome.com/efc83ea599.js"></script>
    <script>
      fetch('bottom-bar.html')
        .then(response => response.text())
        .then(data => {
          document.getElementById('include-bottom-bar').innerHTML = data;
        });
    </script>
  
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7LL5HKKBDL"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
  
      gtag('config', 'G-7LL5HKKBDL');
    </script>
    <script src="loadHeader.js"></script>
  </head>
<body>

    <div class="header-nav-section" id="header-nav"></div> 

    <footer>
        <div id="include-bottom-bar"></div>
    </footer>
    
    <h1>Shabbat Kallot</h1>

    <section class="shabbat-information">
        <p>We would love for you to join us for Shabbat and Sunday at Camp Kinder Ring before our wedding!</p>
        <p>Arrival and check-in at camp are between 4:30pm and 6:00pm on Friday September 20. We're excited to create a Shabbat environment together and ask that you keep Shabbat with us, including not using electronics (at least in public spaces). There will be plenty of prayer, learning, vegan feasting, singing, nature-walking, and lounging, and (if weather permits) a post-havdalah campfire by the lake. (If you need to leave Saturday night, the camp gate will re-open after Shabbat ends, at about 7:45pm.)</p>        
        <p>On Sunday morning there will be shaharit and breakfast.</p>        
        <p>Wedding festivities on Sunday start with a reception and tisch at 3:00pm, and the huppah is at 4:00pm.</p>
        <p>We have reserved a block of cabins and bunks at Camp Kinder Ring for Friday and Saturday nights. We would love to have you join us. Any amount that you wish to contribute between $36 and $360 would be lovely (no cost for children age two and under).</p>
    </section>
   
    <iframe name="hidden_iframe" id="hidden_iframe" class="hidden"></iframe>

    <form id="bookingForm" action="https://docs.google.com/forms/d/e/1FAIpQLSd78nSn4ni4X05CxruUc8LmyNe6rrnHaQO2cTD4xZpLj5JwVQ/formResponse" method="POST" target="hidden_iframe" onsubmit="return handleSubmit();">
        <!-- Your form fields here -->
        <label for="name">Name:</label>
        <input type="text" id="name" name="entry.469551914" required>
        
        <label for="email">Email:</label>
        <input type="email" id="email" name="entry.1883004535" required>

        <label for="canAttend">Will you be able to join us for Shabbat?</label>
        <select id="canAttend" name="canAttend" required>
            <option value="">Select an option</option>
            <option value="yes">Yes!</option>
            <option value="no">Regretfully, no</option>
            <option value="maybe">Some third, more complicated thing</option>
        </select>

        <div id="peopleDetails" class="hidden">

            <label for="adultNumber">Number of adults you are RSVPing for:</label>
            <input type="number" id="adultNumber" name="entry.1405525784" min="0" required>
            
            <label for="kidNumber">Number of children you are RSVPing for:</label>
            <input type="number" id="kidNumber" name="entry.565550636" min="0" required>

            <label for="adultNames">Names of all people you are RSVPing for:</label>
            <textarea id="adultNames" name="entry.959352133" placeholder="Please enter full names for all, including any children age two and under."></textarea>

        </div>

        <div id="formDetails" class="hidden">

            <!-- <label for="SleepingPreferencesText">Sleeping Preferences:</label>
            <textarea id="SleepingPreferencesText" name="entry.2038316463" placeholder="A limited number of cabins are available. If you have a preference between a cabin and a bunk, please let us know here (including the strength of your preference)."></textarea> -->

            <label for="DietaryNeeds">Dietary needs:</label>
            <textarea id="DietaryNeeds" name="entry.41062795" placeholder="All food will be vegan, nut-free, and certified kosher by Go Kosher. If you have any other dietary restrictions, please let us know."></textarea>

            <label for="Accommodations">Accommodations:</label>
            <textarea id="Accommodations" name="entry.284877517" placeholder="If you have any specific housing or other needs (e.g. ADA compliant) please let us know."></textarea>

            <label for="FridayBus">We may have a bus to the venue on Friday, depending on demand. Alternatively, feel free to coordinate carpools via <a href="https://bit.ly/shabbat-carpool" target="_blank">this spreadsheet.</a></label>
            <textarea id="FridayBus" name="entry.353919477" placeholder="If you're interested in taking the Friday bus, let us know here."></textarea>

            <label for="OtherQuestions">Other questions for us?</label>
            <textarea id="OtherQuestions" name="entry.407849913" placeholder="We will try to get back to you by the end of the wedding"></textarea>

        </div>

        <div id="thirdOption" class="hidden">
            <label for="thirdOptionText">Your third, more complicated thing:</label>
            <textarea id="thirdOptionText" name="entry.1668097024" placeholder="Okay, what makes your situation special?"></textarea>
        </div>

        <button type="submit" class="button-style">Submit</button>


        <div id="paypal-button-container" class="hidden">
            <label for="amount">Amount to pay (recommended $36 - $360 per person):</label>
            <input type="number" id="amount" name="entry.932032766" min="0.01" placeholder="Put the dollar amount you wish to contribute *in total*">
            <div id="paypal-button"></div>
        </div>
    </form>


    <div id="customAlert" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <p id="alertText"></p>
        </div>
    </div>

    <script>
        const paypalClientId = 'Adc_MmlTfkpTCCWyAh2bP5vG3ceFYZaYKXcbNFYg7H1pjCfbjxfqhZ57rOVCUOMu7rlTuyd91LpAJYQA' // live client id 
        // const paypalClientId = 'AceKlA6TjthA4vexmgE8c3g0BVl2NrlWHosTWPss2oSOhwhrFneJIxpNuRGaqOQiev87zB6h2d0rsUqM'; // sandbox client id
        const paypalScript = document.createElement('script');
        paypalScript.src = `https://www.paypal.com/sdk/js?client-id=${paypalClientId}&currency=USD&intent=capture&commit=true&disable-funding=paylater`;
        document.head.appendChild(paypalScript);
    </script>

    <script>

        function customAlert(msg) {
            var modal = document.getElementById("customAlert");
            var span = document.getElementsByClassName("close")[0];
            var text = document.getElementById("alertText");
            text.innerHTML = msg;
            modal.style.display = "block";
            span.onclick = function() {
                modal.style.display = "none";
            }
            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }
        }


        function handleSubmit() {
            // eventually we can comment out this function
            const form = document.getElementById('bookingForm');
            const formData = new FormData(form);
            const data = {};
            formData.forEach((value, key) => {
                data[key] = value;
            });
        
            // You can now use 'data' object to log, validate, or modify the data
            console.log(data);
        
            // Optionally, send data to your server here
        
            // Return true to continue with the form submission, false to prevent it
            return true;
        }

        document.getElementById('canAttend').addEventListener('change', function() {
            const peopleDetails = document.getElementById('peopleDetails');
            const formDetails = document.getElementById('formDetails');
            const thirdOption = document.getElementById('thirdOption');
            const kidsNum = document.getElementById('kidNumber');
            const adultsNum = document.getElementById('adultNumber');

            if (this.value === 'yes') {
                peopleDetails.classList.remove('hidden');
                formDetails.classList.remove('hidden');
                thirdOption.classList.add('hidden');
                kidsNum.setAttribute('required', '');
                adultsNum.setAttribute('required', '');
            } else if (this.value === 'no') {
                peopleDetails.classList.remove('hidden');
                formDetails.classList.add('hidden');
                thirdOption.classList.add('hidden');
                kidsNum.setAttribute('required');
                adultsNum.setAttribute('required');
            } else if (this.value === 'maybe') {
                peopleDetails.classList.add('hidden');
                formDetails.classList.add('hidden');
                thirdOption.classList.remove('hidden');
                kidsNum.removeAttribute('required');
                adultsNum.removeAttribute('required');
            }
        });

        // function formSubmitted() {
        //     const canAttend = document.getElementById('canAttend').value;
        //     if (canAttend === 'yes') {
        //         displayPayPalButton();
        //     } else {
        //     }
        // }

        document.getElementById('bookingForm').addEventListener('submit', function(event) {
            const rsvpStatus = document.getElementById('canAttend').value;
            if (rsvpStatus === 'yes') {
                displayPayPalButton();
            } else if (rsvpStatus === 'no') {
                setTimeout(function() {
                    customAlert('Thanks for RSVPing â€” we\'re sorry to hear you can\'t join us, and we hope to celebrate together another time.');
                }, 1000);
            } else if (rsvpStatus === 'maybe') {
                setTimeout(function() {
                    customAlert('Thanks for the information! We\'ll try to get back to you by the end of the wedding.');
                }, 1000);
            }
        });

        document.getElementById('amount').addEventListener('change', displayPayPalButton);

        function displayPayPalButton() {
            document.getElementById('paypal-button-container').classList.remove('hidden');

            // Clear existing PayPal buttons if they exist
            document.getElementById('paypal-button').innerHTML = '';

            const amount = parseFloat(document.getElementById('amount').value).toFixed(2);

            paypal.Buttons({
                createOrder: function(data, actions) {

                    if (amount <= 0) {
                        customAlert('Please enter a positive number for the amount.');
                        return; // Prevent further execution
                    }

                    return actions.order.create({
                        purchase_units: [{
                            amount: {
                                value: amount  // Adjust this value as needed
                            },
                            description: 'Shabbat Kallot Booking'
                        }],
                        application_context: {
                            shipping_preference: 'NO_SHIPPING'
                        }
                    });
                },
                onApprove: function(data, actions) {
                    return actions.order.capture().then(function(details) {

                        const form = document.getElementById('bookingForm');
                        console.log(form);

                        // Add transaction ID to form
                        const transactionIdInput = document.createElement('input');
                        transactionIdInput.type = 'hidden';
                        transactionIdInput.name = 'entry.729439330'; // this is for the paypal transaction id
                        transactionIdInput.value = details.id;
                        form.appendChild(transactionIdInput);

                        // Submit to Google Form
                        const formData = new FormData(form);
                        fetch('https://docs.google.com/forms/d/185vI152rd-Af7lwCKVxd2KujoBSclhJXQSQ2Z0vKc_0/formResponse', {
                            method: 'POST',
                            body: formData,
                            mode: 'no-cors'
                        }).then(() => {
                            customAlert('Booking completed! You successfully paid $' + details.purchase_units[0].amount.value + '. Your transaction ID is: ' + details.id);
                            form.reset();
                        }).catch(error => {
                            console.error('Error:', error);
                            customAlert('There was an error submitting your booking. Please contact us directly.');
                        });
                    });
                }
            }).render('#paypal-button');
        }

    </script>

</body>
</html>