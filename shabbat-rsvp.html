<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Avital & Ricki</title>
    <script src="https://platform.twitter.com/widgets.js"></script>
    <link rel="stylesheet" type="text/css" href="./style.css" />
    <link rel="shortcut icon" href="./img/favicon2.ico" />
    <meta property="og:title" content="Avital & Ricki" />
    <meta property="og:description" content="Wedding website of Avital Morris and Ricki Heicklen" />

  
    <script src="https://use.fontawesome.com/efc83ea599.js"></script>
    <script>
      fetch('bottom-bar.html')
        .then(response => response.text())
        .then(data => {
          document.getElementById('include-bottom-bar').innerHTML = data;
        });
    </script>
  
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7LL5HKKBDL"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
  
      gtag('config', 'G-7LL5HKKBDL');
    </script>
    <script src="loadHeader.js"></script>
  </head>
<body>

    <div class="header-nav-section" id="header-nav"></div> 

    <footer>
        <div id="include-bottom-bar"></div>
    </footer>
    
    <h1>Shabbaton Booking and Payment</h1>

    <section class="shabbat-information">
        <p>We hope you can join us for our wedding shabbaton!</p>
        <p>Please plan to spend all of Shabbat with us. Arrival and check-in at camp are between 4:30 and 6:00pm on Friday (September 20). The camp gates will re-open after havdalah on Saturday evening at about 7:45pm.</p>
        
        <p>There will be plenty of prayer, learning, vegan feasting in the camp dining room, singing, nature-walking, and lounging, and if weather permits, a post-havdalah campfire by the lake.</p>
        
        <p>On Sunday morning there will be shaharit and breakfast.  Wedding festivities start with a reception and tisch at 3pm, and the huppah is at 4pm.</p> 
        
        <p>We have reserved a block of cabins and bunks at Camp Kinder Ring for Friday and Saturday nights. The total cost for the Shabbat (including food) is $360 per person. We would love to have you for any amount that you wish to contribute to that between $36 and $360.</p>
    </section>

    <iframe name="hidden_iframe" id="hidden_iframe" class="hidden" onload="formSubmitted()"></iframe>

    <form id="bookingForm" action="https://docs.google.com/forms/d/e/1FAIpQLSd78nSn4ni4X05CxruUc8LmyNe6rrnHaQO2cTD4xZpLj5JwVQ/formResponse" method="POST" target="hidden_iframe" onsubmit="return handleSubmit();">
        <!-- Your form fields here -->
        <label for="name">Name:</label>
        <input type="text" id="name" name="entry.469551914" required>
        
        <label for="email">Email:</label>
        <input type="email" id="email" name="entry.1883004535" required>

        <label for="canAttend">Will you be able to join us for Shabbat?</label>
        <select id="canAttend" name="canAttend" required>
            <option value="">Select an option</option>
            <option value="yes">Yes!</option>
            <option value="no">Regretfully, no</option>
        </select>

        <div id="formDetails" class="hidden">

            <label for="adultNumber">Number of Adults:</label>
            <input type="number" id="adultNumber" name="entry.1405525784" min="0" placeholder="0" required>

            <label for="adultNames">Names of All Adult Attendees:</label>
            <textarea id="adultNames" name="entry.959352133" placeholder="Please enter the full names of all adult attendees, including yourself, one per line."></textarea>

            <label for="kidNumber">Number of Children:</label>
            <input type="number" id="kidNumber" name="entry.565550636" min="0" placeholder="0" required>

            <label for="kidNames">Names of All Children Attendees:</label>
            <textarea id="kidNames" name="entry.711606456" placeholder="Please enter the full names of all children, one per line."></textarea>

            <label for="SleepingPreferencesText">Sleeping Preferences:</label>
            <input type="text" id="SleepingPreferencesText" name="entry.2038316463" placeholder="Please specify your sleeping preferences.">

            <label for="DietaryNeeds">Dietary Needs:</label>
            <input type="text" id="DietaryNeeds" name="entry.41062795" placeholder="Please specify any dietary needs or restrictions.">

            <label for="Accommodations">Accommodations:</label>
            <input type="text" id="Accommodations" name="entry.284877517" placeholder="Please specify any other accommodations you require.">

            <label for="FridayBus">We may have a bus to the venue on Friday, depending on demand. Alternatively, feel free to coordinate carpools via <a href="https://bit.ly/shabbat-carpool">this spreadsheet.</a></label>
            <input type="text" id="FridayBus" name="entry.353919477" placeholder="If you're interested in taking the Friday bus, put 'Yes' here.">

            <label for="OtherQuestions">Other Questions:</label>
            <input type="text" id="OtherQuestions" name="entry.407849913" placeholder="Please specify any other questions or concerns you have.">

        </div>

        <button type="submit">Submit</button>


        <div id="paypal-button-container" class="hidden">
            <label for="amount">Amount to pay per person (recommended $36 - $360):</label>
            <input type="number" id="amount" name="entry.932032766" min="36">
            <div id="paypal-button"></div>
        </div>
    </form>


    <script>
        const paypalClientId = 'Adc_MmlTfkpTCCWyAh2bP5vG3ceFYZaYKXcbNFYg7H1pjCfbjxfqhZ57rOVCUOMu7rlTuyd91LpAJYQA' // live client id 
        // const paypalClientId = 'AceKlA6TjthA4vexmgE8c3g0BVl2NrlWHosTWPss2oSOhwhrFneJIxpNuRGaqOQiev87zB6h2d0rsUqM'; // sandbox client id
        const paypalScript = document.createElement('script');
        paypalScript.src = `https://www.paypal.com/sdk/js?client-id=${paypalClientId}&currency=USD&intent=capture&commit=true`;
        document.head.appendChild(paypalScript);
    </script>

    <script>
        function handleSubmit() {
            // eventually we can comment out this function
            const form = document.getElementById('bookingForm');
            const formData = new FormData(form);
            const data = {};
            formData.forEach((value, key) => {
                data[key] = value;
            });
        
            // You can now use 'data' object to log, validate, or modify the data
            console.log(data);
        
            // Optionally, send data to your server here
        
            // Return true to continue with the form submission, false to prevent it
            return true;
        }

        document.getElementById('canAttend').addEventListener('change', function() {
            const formDetails = document.getElementById('formDetails');
            const kidsNum = document.getElementById('kidNumber');
            const adultsNum = document.getElementById('adultNumber');

            if (this.value === 'yes') {
                formDetails.classList.remove('hidden');
                kidsNum.setAttribute('required', '');
                adultsNum.setAttribute('required', '');
            } else {
                formDetails.classList.add('hidden');
                kidsNum.removeAttribute('required');
                adultsNum.removeAttribute('required');
            }
        });

        // function formSubmitted() {
        //     const canAttend = document.getElementById('canAttend').value;
        //     if (canAttend === 'yes') {
        //         displayPayPalButton();
        //     } else {
        //     }
        // }

        document.getElementById('bookingForm').addEventListener('submit', function(event) {
            const rsvpStatus = document.getElementById('canAttend').value;
            if (rsvpStatus === 'yes') {
                displayPayPalButton();
            } else if (rsvpStatus === 'no') {
                setTimeout(function() {
                    alert('Thanks for RSVPing â€” we\'re sorry to hear you can\'t join us, and we hope to celebrate together another time.');
                }, 1000);
            }
        });

        function displayPayPalButton() {
            document.getElementById('paypal-button-container').classList.remove('hidden');
            paypal.Buttons({
                createOrder: function(data, actions) {

                    const amount = document.getElementById('amount');
                    const kidsNum = document.getElementById('kidNumber');
                    const adultsNum = document.getElementById('adultNumber');

                    const amountPerPerson = parseFloat(amount.value);
                    const peopleTotal = parseInt(adultsNum.value) + parseInt(kidsNum.value);

                    if (isNaN(amountPerPerson) || isNaN(peopleTotal) || peopleTotal === 0) {
                        alert('Please enter valid numbers for amount per person and number of attendees.');
                        return; // Stop further execution if validation fails
                    }
                    const totalAmount =  (amountPerPerson * peopleTotal).toFixed(2); 

                    return actions.order.create({
                        purchase_units: [{
                            amount: {
                                value: totalAmount  // Adjust this value as needed
                            },
                            description: 'Shabbat Kallot Booking'
                        }],
                        application_context: {
                            shipping_preference: 'NO_SHIPPING'
                        }
                    });
                },
                onApprove: function(data, actions) {
                    return actions.order.capture().then(function(details) {

                        const form = document.getElementById('bookingForm');
                        console.log(form);

                        // Add transaction ID to form
                        const transactionIdInput = document.createElement('input');
                        transactionIdInput.type = 'hidden';
                        transactionIdInput.name = 'entry.729439330'; // this is for the paypal transaction id
                        transactionIdInput.value = details.id;
                        form.appendChild(transactionIdInput);

                        // Submit to Google Form
                        const formData = new FormData(form);
                        fetch('https://docs.google.com/forms/d/185vI152rd-Af7lwCKVxd2KujoBSclhJXQSQ2Z0vKc_0/formResponse', {
                            method: 'POST',
                            body: formData,
                            mode: 'no-cors'
                        }).then(() => {
                            alert('Booking completed! Your transaction ID is: ' + details.id);
                            form.reset();
                        }).catch(error => {
                            console.error('Error:', error);
                            alert('There was an error submitting your booking. Please contact us directly.');
                        });

                        alert('Transaction completed by ' + details.payer.name.given_name + '!');
                        // Optionally, handle post-transaction tasks here
                    });
                }
            }).render('#paypal-button');
        }

    </script>

</body>
</html>